---
title: '10-Route 53'
date: 2024/01/10
---

## 1. DNS

- `DNS(Domain Name System)` : **도메인 이름을 IP주소로 바꿔주는 시스템**이다.
- 웹 사이트의 주소는 IP주소로 변환되어 서버로 연결되기 때문에 DNS가 필요하다.
- e.g. 주소록을 보면 이름과 전화번호가 되어있다.
  - 사람의 이름은 기억하기 쉽지만, 전화번호를 외우는 것은 굉장히 힘들다.
  - 그래서 사람 이름을 선택하고 전화를 걸면 폰에서 저장되어 있는 전화번호로 연결된다.
- 인터넷도 마찬가지로, 서버에 연결하기 위해서는 서버의 IP 주소를 알아야 하는데 IP 주소는 외우기 쉽지 않다.

| 도메인 이름 |     IP주소      |                               |
| :---------: | :-------------: | ----------------------------- |
| google.com  | 172.217.31.174  | (매핑된 것을 레코드라고 부름) |
| amazon.com  | 176.32.103.205  |                               |
|  naver.com  | 125.209.222.141 |                               |

그래서 왼쪽에 있는 도메인 이름을 통해 접속하면, DNS는 이를 IP 주소로 바꿔서 서버에 연결해준다.
그리고 이렇게 도메인 이름과 IP주소가 매핑된 것을 **레코드**라고 부른다.

---

## 2. Route 53

- Route 53은 **Cloud에서 사용하는 DNS**
- Route 53은 클라이언트의 요청을 EC2 인스턴스, ELB 로드 밸런서, S3 버킷, CloudFront 배포 등
  - AWS에서 실행되는 인프라에 효과적으로 연결해서 사용 가능하다.
- 또한 AWS 외부의 인프라로 라우팅하는 데도 Route 53을 사용할 수 있다.

---

### 2.1 Route 53 기본개념

`호스팅 영역(Hosted Zone)`은 레코드의 컨테이너로 2가지 유형이 존재한다.

- `퍼블릭 호스팅 영역`은 **인터넷에서 트래픽을 라우팅하고자 하는 방법을 지정하는 레코드를 포함**하는 것
- `프라이빗 호스팅 영역`은 **VPC에서 트래픽을 라우팅하고자 하는 방법을 지정하는 레코드를 포함**하는 것

`레코드(Record)` : **도메인과 연결된 IP 주소**를 의미

- 특정 도메인(예: example.com)과 그 하위 도메인(예: apex.example.com)의 트래픽을 라우팅하는 방식에 대한 정보를 담고 있다.
- (cf. 호스팅 영역과 해당 도메인의 이름은 동일하다)

AWS 콘솔에서 Route 53에 접속하면, 호스팅 영역을 볼 수 있다.

![호스팅영역](https://cdn.frontoverflow.com/document/first-met-aws/images/chapter_10/hosted_zone.jpeg)

그리고 호스팅 영역을 눌러서 들어가면, 여러 개의 레코드가 있는 것을 볼 수 있다.

![레코드](https://cdn.frontoverflow.com/document/first-met-aws/images/chapter_10/records.jpeg)

---

### 2.2 Route 53 관련 용어

- Route 53과 관련된 용어로는 먼저 **DNS 쿼리**가 있다.
- `DNS 쿼리` : **도메인 이름을 IP주소로 변환하는 요청**이다.
- `A 레코드` : **도메인 이름과 IP주소를 매핑하는 레코드**이다.
  - cf. 여기서 A는 주소를 나타내는 영어 단어 **Address**를 의미한다.
- `DNS 장애 조치` : Route 53에 연결 된 서버 또는 ELB에 장애가 발생할 경우,
  - 다른 대체 위치로 라우팅 해주는 기능

---

### 2.3 Route 53 대표 레코드 유형

- `A (Address)` : 도메인 이름과 IPv4 주소를 매핑하는 레코드
- `AAAA 레코드` : 도메인 이름과 IPv6 주소를 매핑하는 레코드
- `CNAME 레코드` : 현재 레코드의 이름에 대한 DNS 쿼리를 다른 도메인 또는 하위 도메인으로 매핑하는 래코드
  - cf. Canonical Name(별칭 레코드)을 의미하는 레코드
  - e.g. docs.example.com -> documents.example.com
- `MX 레코드` : 이메일을 전달하기 위한 레코드 (Mail eXchange를 의미)
- `NS 레코드` : 네임서버 주소를 담고 있는 레코드 (Name Server를 의미)
- `SOA 레코드` : 도메인에 대한 기본 DNS 정보 식별을 위한 레코드
  - cf. Start of Authority(권한 시작 레코드)를 의미

주의할 점으로 `NS 레코드`와 `SOA 레코드` 두 가지는 호스팅 영역을 생성할 때 자동으로 생성되며, 맘대로 변경하면 안된다

- cf. 다른 지원되는 DNS 레코드 유형 : https://docs.aws.amazon.com/ko_kr/Route53/latest/DeveloperGuide/ResourceRecordTypes.html

---

## 3. Route 53 라우팅 방식

Route 53의 라우팅 방식으로는 다음과 같은 것들이 있다.

- `지연 시간 기반 라우팅 (Latency based routing)`
  - 지연 시간(latency)이 가장 낮은 리전의 IP주소로 라우팅하는 방식
- `가중치 기반 라우팅 (Weighted based Routing)`
  - IP주소나 ELB DNS주소에 각각 가중치(Weight)를 부여하여 가중치에 따라서 라우팅하는 방식
- `지역 기반 라우팅 (Geo Routing)`
  - 지역에 따라서 각기 다른 IP주소로 라우팅하는 방식

cf. https://www.awsforbusiness.com/regions-ec2-available

---

## 4. (실습) 호스팅 영역 생성

[Route 53] → 왼쪽 메뉴 [호스팅 영역] 페이지로 이동한다.

- [호스팅 영역] 생성 버튼을 눌러, 새로운 호스팅 영역을 하나 생성한다.

(호스팅 영역 생성) 페이지

- `도메인 이름` : example.co.kr
  - 지금은 소유한 도메인이 없기 때문에,
  - 그냥 예시도메인을 사용해서 실습만 진행해보는 것
- 화면을 아래로 내려서 [호스팅 영역 생성] 버튼을 클릭한다.
- 그러면 호스팅 영역이 생성된다.

호스팅 영역이 생성된 이후에 클릭해서 들어가보면, 레코드 목록을 볼 수 있다.

- 자동으로 생성된 NS 레코드와 SOA 레코드를 볼 수 있다.
- 이번에는 [레코드 생성] 버튼을 클릭해서 새 레코드를 만들어 보겠다.

(레코드 생성) 화면에서는 먼저 레코드 유형을 선택해야 한다.

- `레코드 유형` : 기본으로 선택되어 있는 A 레코드를 그냥 사용.
- `값` : 매핑시킬 IP 주소를 넣으면 된다.
  - 임의로 이러한 값을 입력 (123.123.123.123)
- 이후 화면 하단에 있는 [레코드 생성] 버튼을 클릭한다.

그럼 목록에 새로운 레코드가 추가된 것을 볼 수 있다.

---

## 5. (실습) 호스팅 영역 삭제

[호스팅 영역] 페이지에서 [영역 삭제] 버튼을 클릭한다.

- 그러면 다이얼로그가 나오는데, 주의 부분을 자세히 보면,
  - 호스팅 영역을 삭제하기 위해서는 NS 및 SOA 레코드를 제외한,
  - 모든 레코드를 삭제해야 한다고 나와 있다.
  - 우선 [취소] 버튼을 눌러서 다이얼로그를 닫는다.
- 이전 실습에서 생성했던 A 레코드를 선택한다.
  - 이후 [레코드 삭제] 버튼을 클릭한다.
  - 레코드 삭제 확인 다이얼로그가 나오면, [삭제] 버튼을 눌러서 레코드를 삭제한다.

이렇게 NS와 SOE 레코드를 제외한 모든 레코드를 삭제했다면, 다시 [영역 삭제] 버튼을 클릭

- 삭제 확인 다이얼로그가 나오면, 입력 필드에 `삭제`라고 입력한다.
- 이후 [삭제] 버튼을 클릭.
- 이렇게 호스팅 영역이 정상적으로 삭제되었다.

cf. Linux나 macOS에서 DNS 서버 정보를 줘야 하는 DIG이라는 명령어가 있으니, 필요한 경우 사용

```bash
$ dig google.com

; <<>> DiG 9.10.6 <<>> google.com
;; global options: +cmd
;; Got answer:
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 55019
;; flags: qr rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1

;; OPT PSEUDOSECTION:
; EDNS: version: 0, flags:; udp: 4096
;; QUESTION SECTION:
;google.com.			IN	A

;; ANSWER SECTION:
google.com.		209	IN	A	142.250.76.142

;; Query time: 11 msec
;; SERVER: 210.220.163.82#53(210.220.163.82)
;; WHEN: Mon Jan 15 06:06:32 KST 2024
;; MSG SIZE  rcvd: 55
```

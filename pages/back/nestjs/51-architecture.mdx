---
title: '50-kubernetes-helm'
date: 2023/12/25
---

## 1. Clean Architecture

![](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

cf. https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html

- `Clean Architecture`ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ `ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§`ê³¼ `ì™¸ë¶€ ì‹œìŠ¤í…œ`ì„ ë¶„ë¦¬í•˜ëŠ” ì•„í‚¤í…ì²˜ë‹¤.
  - Hexagonal Architectureì—ì„œ ì˜ê° ë°›ì€ í˜•íƒœë¡œ
  - Robert Martinì´ë¼ëŠ” ì‚¬ëŒì´ 2017ë…„ì— ì±…ìœ¼ë¡œ ì¶œê°„í•œ ê°œë…ì´ë‹¤.
- `Hexagonal Architecture`ì™€ ë§¤ìš° ìœ ì‚¬í•˜ì§€ë§Œ ìš©ì–´ì™€ êµ¬ë¶„ì´ ì•½ê°„ ë‹¤ë¥´ë‹¤

---

### 1.1 Clean Architecture Layers

![](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

- `Framework & Driver Layer`
  - ì™¸ë¶€ ë””íœë˜ì‹œë“¤ì´ ì¡´ì¬í•˜ëŠ” ì˜ì—­ì´ë‹¤.
  - ì˜ˆë¥¼ë“¤ì–´ Database, REST API Call, UI, í”„ë ˆì„ì›Œí¬ ì½”ë“œë“±ì´ ë  ìˆ˜ ìˆë‹¤.
- `Interface Adapters`
  - Usecaseì™€ Entitiesë¥¼ ìœ„í•´ ì¡´ì¬í•˜ëŠ” ë ˆì´ì–´ë‹¤.
  - ê°€ì¥ ì¤‘ìš”í•œ ë¡œì§ì´ ìë¦¬ì¡ê³  ìˆëŠ” Use Caseì™€ Entitiesì—ì„œ ì‚¬ìš©í•˜ê¸° ê°€ì¥ í¸í•œ í˜•íƒœë¡œ ë°ì´í„°ë¥¼ ë³€í™˜í•˜ê³  ì „ë‹¬í•œë‹¤.
- `Use Case`
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì— íŠ¹í™”ëœ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì‘ì„±ë˜ëŠ” ìœ„ì¹˜ë‹¤.
  - ì‹œìŠ¤í…œì˜ ê¸°ëŠ¥ë“¤ì„ êµ¬í˜„í•˜ê³  ì¶”í›„ ì†Œê°œë  Entitiesë“¤ì´ ì• í”Œë¦¬ì¼€ì´ì…˜ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì†Œí™” í•  ìˆ˜ ìˆë„ë¡ ìœ ë„í•œë‹¤.
- `Entities`
  - ê¸°ì—… ì „ë°˜ì ìœ¼ë¡œ ì ìš©ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ì‘ì„±ë˜ëŠ” ìœ„ì¹˜ë‹¤.
  - ê¸°ì—…ì— ë‹¨ í•˜ë‚˜ì˜ ì• í”Œë¦¬ì¼€ì´ì…˜ë§Œ ì¡´ì¬í•œë‹¤ë©´ ë„ë©”ì¸ ê°ì²´ë“¤ ì •ë„ë¡œ ìƒê°í•´ ë„ ëœë‹¤.

---

### 1.2 Dependency Rule

![](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

- ì›ì˜ ë‚´ë¶€ì— ìˆëŠ” ë ˆì´ì–´ëŠ” ë°”ê¹¥ì˜ ë³€ê²½ì— ì˜í–¥ì„ ë°›ìœ¼ë©´ ì•ˆëœë‹¤.
- ì™¸ë¶€ ë ˆì´ì–´ëŠ” ë‚´ë¶€ ë ˆì´ì–´ì— ì˜ì¡´ í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ë‚´ë¶€ ë ˆì´ì–´ëŠ” ì™¸ë¶€ ë ˆì´ì–´ì— ì˜ì¡´í•˜ë©´ ì•ˆëœë‹¤.
- ì˜ì¡´ì„±ì˜ ì—­ì „ì„ ìœ„í•´ Dependency Inversionì„ ì‚¬ìš©í•œë‹¤

---

### 1.3 Use Case

![](https://blog.cleancoder.com/uncle-bob/images/2012-08-13-the-clean-architecture/CleanArchitecture.jpg)

- Hexagonal Architectureì™€ ê°€ì¥ ë‹¤ë¥¸ì (?) ì´ë¼ê³  ë³¼ ìˆ˜ ìˆë‹¤.
- Clean ArchitectureëŠ” SRP (Single Responsibility Principle)ì„ ê°•ì¡°í•œë‹¤.
  - ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë ˆì´ì–´ì—ì„œ ì‹¤í–‰í•´ì•¼í•  ê¸°ëŠ¥ í•˜ë‚˜ í•˜ë‚˜ë¥¼ í•˜ ë‚˜ì˜ í´ë˜ìŠ¤ì— ì •ì˜í•œë‹¤.

---

## 2. Hexagonal Architecture

### 2.1 Hexagonal Architectureë€?

- `Hexagonal Architecture`ëŠ” Domainì„ ì¤‘ì•™ì— ê°ì‹¸ëŠ” ì•„í‚¤í…ì²˜ì¤‘ ê°€ì¥ ë¨¼ì € ê³ ì•ˆëœ ì•„í‚¤í…ì²˜ ì¤‘ í•˜ë‚˜ì´ë‹¤.
- `Port and Adapter íŒ¨í„´`ìœ¼ë¡œë„ ë¶ˆë¦¬ë©°,
  - ê°œì¸ì ìœ¼ë¡  ì´ ëª…ì¹­ì´ ì¡°ê¸ˆ ë” ì•„í‚¤í…ì²˜ì˜ íŠ¹ì„±ì„ ì˜ í‘œí˜„í•œë‹¤ê³  ìƒê°í•œë‹¤.
- ë”ì´ìƒ `Layered Architecture`ì²˜ëŸ¼ Top Down í˜•íƒœê°€ ì•„ë‹ˆë‹¤.
- ë„ë©”ì¸ì„ ì¤‘ì‹¬ìœ¼ë¡œ ì„¤ê³„ë˜ê³  ì™¸ë¶€ ì˜ì¡´ì„±ë“¤ì„ Domainì˜ ì„¤ê³„ì— ë§ì¶°ì„œ í”„ë¡œê·¸ë˜ë° í•˜ê²Œ ëœë‹¤.
- ë„ë©”ì¸ì´ ì¤‘ì‹¬ì— ìˆê³  ë°”ê¹¥ì´ ë‚´ë¶€ë¡œ ì˜ì¡´í•˜ëŠ” êµ¬ì¡°ë¥¼ ê°–ê²Œ ëœë‹¤.
  - ê°€ì¥ ì¤‘ì‹¬ì—ëŠ” ë„ë©”ì¸ì´ ìˆê¸° ë•Œë¬¸ì—, ë„ë©”ì¸ì€ ê·¸ ë¬´ì—‡ì—ë„ ì˜ì¡´í•˜ì§€ ì•ŠëŠ” ë…ë¦½ì ì¸ ì¡´ì¬ê°€ ëœë‹¤.
  - ì¦‰, ì¤‘ì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì€ ì™¸ë¶€ì— ì˜í–¥ì„ ë°›ì§€ ì•Šê²Œ ëœë‹¤

---

### 2.2 Domainì´ë€?

- `Domain`ì´ë€ **ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ í•´ê²°í•˜ê³ ìí•˜ëŠ” íŠ¹ì • ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì—­**ì„ ì–˜ê¸°í•œë‹¤.
- `Domain`ì€ ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ë‚˜ ì‹œìŠ¤í…œì˜ ë¬¸ì œ, í”„ë¡œì„¸ìŠ¤, ê·œì¹™ ë“±ì„ í¬í•¨í•˜ë©° ì´ë¥¼ ì†Œí”„íŠ¸ì›¨ì–´ì— ë°˜ì˜í•œë‹¤.

ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ í•´ê²°í•´ì•¼í•˜ëŠ” `í•µì‹¬ ê´€ì‹¬ì‚¬`ë‹¤.

- `í•µì‹¬ ê´€ì‹¬ì‚¬`ì´ê¸° ë•Œë¬¸ì— í° í‹€ì—ì„œ ìì£¼ ë°”ë€Œì§€ ì•ŠëŠ”ë‹¤.
- ì „ì ìƒê±°ë˜ ì‹œìŠ¤í…œì—ëŠ” **ì£¼ë¬¸, ê²°ì œ, ì¬ê³ ê´€ë¦¬, ê³ ê°**ì´ ë„ë©”ì¸ì´ ë  ìˆ˜ ìˆë‹¤.
- (ë§ˆì¹˜ ìš°ë¦¬ê°€ ìƒì„±í•œ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤ì²˜ëŸ¼)
- ì˜ë£Œ ì‹œìŠ¤í…œì—ëŠ” **í™˜ì ê¸°ë¡, ì˜ˆì•½, ì¹˜ë£Œ ê³¼ì •** ë“±ì´ ë„ë©”ì¸ì´ ë  ìˆ˜ ìˆë‹¤.

ë„ë©”ì¸ì€ â€œì‹¤ì œâ€ ë¹„ì¦ˆë‹ˆìŠ¤ì—ì„œ í•´ê²°í•´ì•¼í•˜ëŠ” ê´€ì‹¬ì‚¬ì´ê¸° ë•Œë¬¸ì— ê°œë°œìê°€ ì•„ë‹Œ ì‚¬ëŒë“¤ê³¼ ìš©ì–´ ì†Œí†µì´ ìš©ì´í•˜ë‹¤.

- ì¼ë°˜ ì‚¬ëŒë“¤ë„ ì´í•´ í•  ìˆ˜ ìˆëŠ” ìš©ì–´ì¸ â€œì£¼ë¬¸â€, â€œê²°ì œâ€, â€œì¬ê³ â€ë“±ì´ ìš©ì–´ê°€ ë˜ê¸° ë•Œë¬¸ì— ë¹„ê°œë°œìë„ ì´í•´í•˜ê¸° ì‰½ë‹¤.
- ì´ê±¸ `Ubiquitous Language (ê³µí†µ ì–¸ì–´)`ë¼ê³  ë¶€ë¥¸ë‹¤

---

### 2.3 Domain ê°ì²´ë€?

- Domain ê°ì²´ëŠ” Domainì„ ì¶”ìƒì ìœ¼ë¡œ í‘œí˜„í•œ í´ë˜ìŠ¤ë‹¤.
- ìš°ë¦¬ê°€ ì§€ê¸ˆê¹Œì§€ ì œì‘í•´ì˜¨ Entityë“¤ì´ Domain ê°ì²´ì™€ ë§¤ìš° â€œë¹„ìŠ·â€í•˜ë‹¤.
- Domain ê°ì²´ëŠ” í”„ë¡œì íŠ¸ì—ì„œ ê°€ì¥ ì¤‘ì‹¬ë˜ëŠ” ì½”ë“œì´ë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, ì‡¼í•‘ëª° ì‹œìŠ¤í…œì˜ ê²°ì œ PGì‚¬ê°€ Aì‚¬ì—ì„œ Bë¡œ ë³€ê²½ëœë‹¤ê³  í•˜ë”ë¼ë„,
  - ë„ë©”ì¸ ê°ì²´ì— â€œê²°ì œâ€ë¼ëŠ” ê°œë…ì´ ì¡´ì¬í•´ì•¼í•œë‹¤ëŠ” ê±´ ë³€í•˜ì§€ ì•ŠëŠ”ë‹¤.
- ë„ë©”ì¸ì€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ì¤‘ìš”í•œ ë¶€ë¶„ì„ ë‹´ë‹¹í•˜ì§€ë§Œ, ì™¸ë¶€ ì˜ì¡´ì„± ì—†ì´ ê°€ì¥ í•„ìš”í•œ ë¶€ë¶„ë§Œ ë‹¨ìˆœí•˜ê²Œ êµ¬í˜„í•œë‹¤.
  - ë„¤ì´í‹°ë¸Œ ì–¸ì–´ë¡œ êµ¬í˜„ ê°€ëŠ¥í•œ ë¡œì§ê³¼ ê²€ì¦ì„ ì£¼ë¡œ êµ¬í˜„í•œë‹¤.

---

### 2.4 Domain ê°ì²´ ì˜ˆì œ

```js
export class Order {
  private readonly id : string;
  private products: Product[];
  private shippingAddress: Address;
  private totalPrice: number;
  private status: OrderStatus;

  constructor(id: string, products: Product[], shippingAddress: Address) {
    if (!id) throw new Error('Order IDëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');
    if (products.length === 0) throw new Error('ì£¼ë¬¸ì€ ì‚¬í’ˆ í•˜ë‚˜ ì´ìƒ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.');
    if (!shippingAddress) throw new Error('ë°°ì†¡ì§€ ì •ë³´ëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤.');

    this.id = id;
    this.products = products;
    this.shippingAddress = shippingAddress;
    this.totalPrice = this.calculateTotalPrice();
    this.status = OrderStatus.PENDING;
  }

  // ì—¬ê¸°ë¶€í„° Business Logic
  addProduct(product: Product): void {
    this.products.push(product);
    this.totalPrice = this.calculateTotalPrice();
  }
  removeProduct(productId: string): void {}
  changeShippingAddress(newAddress: Address): void {}
  completeOrder(): void {}
  cancelOrder(): void {}
  calculateTotalPrice() : number {}
}
```

---

### 2.5 Domain Business Logic

```js
export class Order {
  // ìƒëµ
  addProduct(product: Product): void {
    this.products.push(product)
    this.totalPrice = this.calculateTotalPrice()
  }

  removeProduct(productId: string): void {
    this.products = this.products.filter((product) => product.id !== productId)
    // ê²€ì¦
    if (this.products.length === 0) {
      throw new Error('ì£¼ë¬¸ì€ ìµœì†Œ í•˜ë‚˜ì˜ ìƒí’ˆì´ ìˆì–´ì•¼ í•©ë‹ˆë‹¤.')
    }
    this.totalPrice = this.calculateTotalPrice()
  }

  changeShippingAddress(newAddress: Address): void {
    this.shippingAddress = newAddress
  }

  completeOrder(): void {
    if (this.status !== OrderStatus.PENDING) {
      throw new Error('ì£¼ë¬¸ì„ ì™„ë£Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Pending ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.')
    }
    this.status = OrderStatus.COMPLETED
  }

  cancelOrder(): void {
    if (this.status !== OrderStatus.PENDING) {
      throw new Error('ì£¼ë¬¸ì„ ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. Pending ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.')
    }
    this.status = OrderStatus.CANCELED
  }

  private calculateTotalPrice(): number {
    return this.products.reduce((total, product) => total + product.price, 0)
  }
}
```

- ë„ë©”ì¸ì˜ ê°€ì¥ ì¤‘ìš”í•œ ë…¼ë¦¬ë“¤ì„ ë‹´ê³ ìˆëŠ”ë‹¤.
- ê°€ì¥ ì¤‘ìš”í•˜ì§€ë§Œ ë‹¨ìˆœí•œ ë¡œì§ìœ¼ë¡œ í–‰ì‚¬í•œë‹¤.
- ì™¸ë¶€ ì˜ì¡´ì„±ì´ ì—†ì–´ì•¼í•œë‹¤.
  - ì™¸ë¶€ì— ì˜ì¡´í•˜ê²Œ ë˜ë©´ ì™¸ë¶€ ì˜ì¡´ì„±ì´ ë³€ê²½ëì„ë•Œ, ë„ë©”ì¸ì´ í•¨ê»˜ ë³€ê²½ë¼ì•¼ í•œë‹¤.
  - ë„ë©”ì¸ì€ ì ˆëŒ€ë¡œ ì™¸ë¶€ì— ì˜í•´ ë³€ê²½ ë˜ë©´ ì•ˆëœë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ í° ë³€ê²½ì‚¬í•­ì´ ìˆë‹¤ë©´ ì´ ë³€ê²½ì‚¬í•­ì€ ë„ë©”ì¸ìœ¼ë¡œë¶€í„° íŒŒìƒë¼ì•¼í•œë‹¤.
  - ë‹¤ë¥¸ ì™¸ë¶€ ìš”ì†Œ ê°€ ë„ë©”ì¸ì„ ë³€ê²½ì‹œí‚¤ë©´ ì•ˆëœë‹¤.

![fastcam-architecture_51-1](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-1.png)

![fastcam-architecture_51-2](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-2.png)

![fastcam-architecture_51-3](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-3.png)

![fastcam-architecture_51-4](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-4.png)

- PortëŠ” Adapterê°€ ì—°ë™ í•  ìˆ˜ ìˆëŠ” ìŠ¤í™ì˜ ëª…ì‹œì´ê¸° ë•Œë¬¸ì— í•­ìƒ interface í˜•íƒœë¡œ êµ¬í˜„í•œë‹¤.
  - (OOPì˜ interfaceë¥¼ ê¼­ ì¨ì•¼í•œë‹¤ëŠ” ì´ì•¼ê¸°ëŠ” ì•„ë‹˜)
  - ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ì–´ë–»ê²Œ ì‘ë™í• ì§€ ì¼ë°˜í™”ëœ ìŠ¤í™ (contract)ë¥¼ portì— ëª…ì‹œí•´ë‘”ë‹¤.
  - Application ë‚´ë¶€ì—ì„œëŠ” ì´ ìŠ¤í™ì— ë”°ë¼ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤. ì´ êµ¬í˜„ëœ ê¸°ëŠ¥ì„ Adapterê°€ ì‚¬ìš©í•œë‹¤.
  - Portì— ëŒ€í•œ ìŠ¤í™ì€ ë°”ë€Œì§€ ì•Šê¸° ë•Œë¬¸ì— Application ë‚´ë¶€ëŠ” ì™¸ë¶€ ë¡œì§ì— ì˜í–¥ì„ ë°›ì§€ ì•ŠëŠ”ë‹¤.
  - ìƒˆë¡œìš´ Adapterë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤ë©´,
    - Portì˜ ìŠ¤í™ì— ë§ê²Œ Adapterë§Œ êµ¬í˜„í•´ì£¼ë©´, Application ë¡œì§ì€ ì „í˜€ ê±´ë“œë¦´ í•„ìš”ê°€ ì—†ë‹¤.
- Applicationì—ì„œ ì‘ì—…í•œ ë¡œì§ì´ Driven ì‚¬ì´ë“œë¡œ ì–´ë–»ê²Œ ì „ë‹¬ë ì§€ ìŠ¤í™ì„ portì— ëª…ì‹œí•´ë‘”ë‹¤.
  - Application ë‚´ë¶€ì—ì„œëŠ” ì´ ìŠ¤í™ì„ ì‚¬ìš©í•˜ê³  ì™¸ë¶€ì—ì„œ Portì— ëŒ€í•œ ê¸°ëŠ¥ì„ êµ¬í˜„í•œë‹¤

---

### 2.6 Dependency Inversion

- ì–´ë–»ê²Œí•˜ë©´ ë„ë©”ì¸ì„ ê·¸ ë¬´ì—‡ì—ë„ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?
- ë‹¨ìˆœí•œ ì§ˆë¬¸ì´ì§€ë§Œ ì²˜ìŒ â€œì•„í‚¤í…ì²˜â€ì˜ ê°œë…ì„ ì ‘í•œë‹¤ë©´ ì–´ë ¤ìš¸ ìˆ˜ ìˆë‹¤.
- Layered ArchitectureëŠ” Top Down ë°©ì‹ì´ê¸° ë•Œë¬¸ì— ì¸í”„ë¼ê°€ ë³€ë™ë˜ë©´ ì–´ì©” ìˆ˜ ì—†ì´ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì´ ë³€ê²½ëœë‹¤.
  - ìš°ë¦¬ê°€ ì œì‘í•œ í”„ë¡œê·¸ë¨ì—ì„œ ORMì„ TypeORMì—ì„œ Mongooseë¡œ ë³€ê²½í•œë‹¤ê³  ìƒê°í•´ë³´ì.
  - ëª¨ë“  Service ë¡œì§ì„ ë‹¤ì‹œ ì‘ì„±í•´ì•¼ ë  ê²ƒì´ë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ ìœ„ì¹˜ê°€ ì˜ì¡´ì„±ì˜ ëì´ ì•„ë‹Œë° ì–´ë–»ê²Œ ì–´ë””ì—ë„ ì˜ì¡´í•˜ì§€ ì•Šê²Œ ë§Œë“¤ ìˆ˜ ìˆì„ê¹Œ?
  - ë‹µì€ Dependency Inversionì— ìˆë‹¤

---

### 2.7 Repository Pattern

ì ê¹ ë‹¤ë¥¸ ì´ì•¼ê¸°ë¥¼ í•´ë³´ì. ì´ë¯¸ ìš°ë¦¬ê°€ ìµìˆ™í•œ ì½”ë“œì´ê¸° ë•Œë¬¸ì— ì´í•´í•˜ëŠ”ë° ë„ì›€ëœë‹¤

- TypeORMì€ ìš°ë¦¬ê°€ ì—°ê²°í•˜ëŠ” ë°ì´í„°ë² ì´ìŠ¤ì™€ ê´€ê³„ ì—†ì´ ëª¨ë‘ ê°™ì€ API ì¸í„°í˜ì´ìŠ¤ë¥¼ ì œê³µí•œë‹¤.
- ìš°ë¦¬ê°€ Layered Architectureì—ì„œ ì •ì˜í•œ ê°œë…ë“¤ì„ ìƒê°í•´ë³´ë©´, ë°ì´í„°ë² ì´ìŠ¤ê°€ ë°”ë€Œë©´ ìœ„ ë ˆì´ì–´ì˜ ë¡œì§ì— ë³€í™”ë¥¼ ì£¼ê²Œëœë‹¤.
  - ê·¸ëŸ°ë° TypeORMì€ ë°ì´í„°ë²  ì´ìŠ¤ë¥¼ í†µì§¸ë¡œ ë°”ê¿”ë„ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ì „í˜€ ìˆ˜ì •í•  í•„ìš”ê°€ ì—†ë‹¤.
- ì–´ë–»ê²Œ ê°€ëŠ¥í•œ í‘ë§ˆë²•ì¸ê°€?

> ğŸ’¡ì˜ì¡´ì„± íë¦„
>
> Controller â†’ Service â†’ Repository(e.g. Postgres, MySQL, mongoDB)

---

### 2.8 Repository Pattern

![fastcam-architecture_51-5](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-5.png)

- í‘ë§ˆë²•ì€ interfaceë¡œ ê°€ëŠ¥í•˜ë‹¤.
- TypeORMì—ì„œ TypeORMê³¼ ì—°ë™í•  ìˆ˜ ìˆëŠ” ë£°ì„ interface ë¡œ ì •ì˜í•œë‹¤.
- ì´ ì •ì˜ë“¤ì´ ë°”ë¡œ find, findOne, update, delete ê°™ì€ í•¨ìˆ˜ë“¤ì´ë‹¤.
- TypeORMì„ ì§€ì›í•  ë°ì´í„°ë² ì´ìŠ¤ë“¤ ì€ ì´ ë£°ì— ë§ì¶°ì„œ ê° ì‹œìŠ¤í…œì˜ ì¿¼ë¦¬ë¥¼ ì™„ì„±í•˜ë©´ ëœë‹¤.
- TypeORMì´ ê° ë°ì´í„°ë² ì´ìŠ¤ì— ì˜ì¡´í•´ì•¼í–ˆë˜ ìƒí™©ì—ì„œ ë°ì´í„°ë² ì´ìŠ¤ë“¤ì´ TypeORM ì— ì •ì˜ëœ ë£° ì— ì˜ì¡´í•˜ëŠ” ìƒí™©ì´ ëœë‹¤.
- ì´ê²Œ ë°”ë¡œ Dependency Inversion ì´ë‹¤

---

### 2.9 Dependency Inversion

![fastcam-architecture_51-6](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-6.png)

---

## 3. Layered Architecture

`Layered Architecture`ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì—¬ëŸ¬ê°œì˜ ë ˆì´ì–´ë¡œ ë‚˜ëˆ„ëŠ” ì„¤ê³„ë‹¤.

- ê° ë ˆì´ì–´ë³„ë¡œ íŠ¹í™”ëœ ì˜ì—­ì„ ë‹´ë‹¹í•œë‹¤.
- ëª¨ë“  ë ˆì´ì–´ëŠ” ë°”ë¡œ ì•„ë˜ì˜ ë ˆì´ì–´ì—ë§Œ ì˜ì¡´í•œë‹¤.
- ë ˆì´ì–´ë¥¼ ì–´ë–»ê²Œ ëª‡ê°œë¡œ ë‚˜ëˆŒì§€ì— ëŒ€í•œ ì •ë‹µì€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - (í•˜ì§€ë§Œ ì–´ëŠì •ë„ í‹€ì€ ì¡´ì¬í•œë‹¤..!)

![fastcam-architecture_51-7](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-7.png)

(1) `Presentation Layer`ëŠ” ì§ì—­ì ìœ¼ë¡œ í•´ì„ í–ˆì„ë•Œ **UIë¥¼ ì˜ë¯¸**í•œë‹¤.

- í•˜ì§€ë§Œ ì•„í‚¤í…ì²˜ëŠ” ì–´ë–¤ ë¬¸ë§¥ì´ë“  ì ìš© í•  ìˆ˜ ìˆì–´ì•¼ í•˜ê¸° ë•Œë¬¸ì— ê·¸ëƒ¥ ìµœì „ë°©ì´ë¼ê³  ìƒê°í•˜ë©´ ëœë‹¤.
- ì¦‰, NestJSì˜ ë¬¸ë§¥ì—ì„œëŠ” `Controller`ê°€ ëœë‹¤.

```js
@Controller('orders')
export class OrderController {
  constructor(private readonly orderService: OrderService) {}

  @Post()
  async createOrder(@Body() createOrderDto: CreateOrderDto) {
    return this.orderService.createOrder(createOrderDto);
  }

  @Get(':id')
  async getOrder(@Param('id') id: string) {
    return this.orderService.getOrder(id);
  }
}
```

---

(2) `Business Layer`ëŠ” **ì‹¤ì œ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ ë‹´ë‹¹í•˜ëŠ” ì˜ì—­**ì´ë‹¤.

- â€œë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§â€ì€ ë§ ê·¸ëŒ€ë¡œ â€œë¹„ì¦ˆë‹ˆìŠ¤â€ì˜ â€œë¡œì§â€
- ì¦‰, í˜„ì‹¤ ì„¸ê³„ì˜ ì¡´ì¬í•˜ëŠ” ë¬¸ì œë“¤ì„ í•´ê²°í•˜ëŠ” ë¡œì§ì´ë¼ê³  ìƒê° í•  ìˆ˜ ìˆë‹¤.
- NestJSì—ì„œëŠ” `Service`ê°€ í•´ë‹¹ëœë‹¤.

```js
@InJectable()
export class OrderService {
  constructor(
    private readonly orderRepository: OrderRepository,
    private readonly productRepository: ProductRepository,
  ) {}

  async createOrder(createOrderDto: CreateOrderDto) {
    const productPrices = await this.productRepository.getProductPrices();

    const order = new Order(createOrderDto.customrId, createOrderDto.items);
    const total = order.calculateTotal(productPrices);

    await this.orderRepository.save(order);

    return { message: 'Order created successfully', orderId: order.id, total };
  }

  async getOrder(orderId: string) {
    return this.orderRepository.findById(orderId);
  }
}
```

---

(3) `Persistence Layer`ëŠ” ì§ì—­í•˜ë©´ **ì˜ì†ì„± ë ˆì´ì–´**ë¼ê³  ë¶€ë¥¼ ìˆ˜ ìˆë‹¤.

- â€œì˜ì†ì„±â€ì´ê¸° ë•Œë¬¸ì— ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì˜ë¯¸í•˜ëŠ”ê±¸ë¡œ ìƒê° í•  ìˆ˜ ìˆì§€ë§Œ,
- ì´ ìƒí™©ì—ì„œëŠ” `Databaseì™€ ì—°ë™í•˜ëŠ” ë ˆì´ì–´`ë‹¤.
- ë§Œì•½ì— Database Layerê°€ ë”°ë¡œ ì—†ì—ˆë‹¤ë©´ ë‘ í¬ì§€ì…˜ì„ ëª¨ë‘ ë§¡ì„ ìˆ˜ ë„ ìˆë‹¤.

```js
@InJectable()
export class OrderRepository {
  constructor(
    @InjectRepository(OrderEntitiy)
    private readonly repository: Repository<OrderEntity>
  ) {}

  async save(order: Order): Promise<void> {
    const orderEntity = this.repository.create({
      id: order.id,
      customerId: order.customerId,
      items: JSON.stringify(order.items),
      createdAt: order.createdAt,
    })
    await this.repository.save(orderEntity)
  }

  async findById(orderId: string): Promise<Order | null> {
    const orderEntity = await this.repository.findOneBy({id: orderId})
    if (!orderEntity) return null

    return new Order(
      orderEntity.customerId,
      JSON.parse(orderEntity.items),
    )
  }
}
```

---

(4) `DatabaseLayer`ëŠ” ë§ ê·¸ëŒ€ë¡œ **ë°ì´í„°ë² ì´ìŠ¤ì˜ ì˜ì—­**ì´ë‹¤.

- e.g. Postgres, MongoDB, MySQL

---

### 3.1 Layered Architectureì˜ ë¬¸ì œ

- ëª¨ë“  ì•„í‚¤í…ì²˜ì˜ ê³µí†µ ê´€ì‹¬ì‚¬ëŠ” â€œì˜ì¡´ì„±â€ì´ë‹¤. ì–´ë–¤ ë°©í–¥ìœ¼ë¡œ ì˜ì¡´ì„±ì´ ì „íŒŒë˜ê³  ìˆëŠ”ì§€ê°€ ë§¤ìš° ì¤‘ìš”í•˜ë‹¤.
- `Layered Architecture`ëŠ” ìœ„ì—ì„œ ì•„ë˜ë¡œ ì˜ì¡´í•˜ëŠ” êµ¬ì¡°ì´ë‹¤.
  - Top Down ë°©ì‹ì´ ì‚¬ëŒì—ê²Œ ê°€ì¥ ìì—°ìŠ¤ëŸ¬ìš´ êµ¬í˜„ì´ê¸° ë•Œë¬¸ì—,
  - í˜„ëŒ€ ì†Œí”„íŠ¸ì›¨ì–´ì—ì„œ `Layered Architecture`ë¥¼ ìì—°ìŠ¤ëŸ½ê²Œ ë§ì´ ì‚¬ìš©í•˜ê²Œ ëœë‹¤.
- `Layered Architecture`ëŠ” ê²°êµ­ ëª¨ë“  ë ˆì´ì–´ê°€ ê°€ì¥ ì•„ë˜ì— ì˜ì¡´í•˜ê²Œ ë˜ê¸° ë•Œë¬¸ì—,
  - ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„ë¥¼ í• ë•Œ ìì—°ìŠ¤ëŸ½ê²Œ ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ë¶€í„° ìƒê°í•˜ê²Œ ëœë‹¤.
  - ìš°ë¦¬ê°€ ì¼ë°˜ì ìœ¼ë¡œ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì²˜ìŒ ë§Œë“¤ë•Œë¥¼ ìƒê°í•´ë³´ì.
  - ê°€ì¥ ë¨¼ì € ìƒê°í•˜ëŠ”ê±´ â€œí…Œì´ë¸” ì–´ë–»ê²Œ ë§Œë“¤ì§€?â€ë‹¤.
- ì—¬ê¸°ì„œ ì˜ë¬¸ì´ ìƒê¸°ê²Œ ëœë‹¤. ì†Œí”„íŠ¸ì›¨ì–´ê°€ í’€ì–´ë‚´ë ¤ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ë¬¸ì œê°€ `Business Logic`
  - ì¦‰, `Business Layer`ì— ìˆëŠ” ë¬¸ì œë“¤ì¸ë° ì´ ë¶€ë¶„ì´ ê³¼ì—° ì™¸ë¶€ì ì¸ ìš”ì¸ì— ì˜í–¥ì„ ë°›ê²Œë˜ëŠ”ê²Œ ë§ëŠ”ê²ƒì¸ê°€?
- ì´ê²Œ ì˜ëª»ëë‹¤ ìƒê°í•´ì„œ ë§Œë“¤ì–´ë‚¸ ì•„í‚¤í…ì²˜ê°€ `Clean Architecture`ì™€ `Hexagonal Architecture`ë‹¤.
  - ì ˆëŒ€ë¡œ ì •ë‹µì€ ì—†ë‹¤.
  - Layered ArchitectureëŠ” ëˆ„êµ¬ë‚˜ ì§ê´€ì ìœ¼ë¡œ ì´í•´ í•  ìˆ˜ ìˆê³  ìì—°ìŠ¤ëŸ½ê²Œ ì½”ë“œë¥¼ ì‘ì„± í•  ìˆ˜ ìˆë‹¤.
  - í•˜ì§€ë§Œ Clean Architecture ì™€ Hexagonal ArchitectureëŠ” ì‚¬ê³  ë°©ì‹ë¶€í„° ë°”ê¿”ì•¼í•œë‹¤.
  - ê²°êµ­ ì¸ë ¥ íŠ¸ë ˆì´ë‹ ë¹„ìš©ë„ ëŠ˜ì–´ë‚˜ê³  ë‹¨ê¸°ì ìœ¼ë¡  ê°œë°œ ì‹œê°„ë„ ëŠ˜ì–´ë‚œë‹¤.
  - ì ˆëŒ€ì ì¸ ê°•ìëŠ” ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤.
  - ìš°ë¦¬ê°€ MSAë¥¼ ë°°ìš°ë©° ê¹¨ìš°ì³¤ë˜ ì ë“¤ì„ ë˜ëŒì•„ë³´ì

---

## 4. Domain Driven Design(DDD) & Polyrepo MSA

### 4.1 Monorepo vs Polyrepo

- Monorepository MSAëŠ” í˜„ì¬ ìš°ë¦¬ê°€ í•˜ê³  ìˆëŠ”ê²ƒì²˜ëŸ¼ í•˜ë‚˜ì˜ ë ˆí¬ì§€í† ë¦¬ë¡œ ì—¬ëŸ¬ê°œì˜ Microserviceë¥¼ ê°œë°œí•˜ëŠ” ë°©ì‹ì´ë‹¤.
- Polyrepository MSAëŠ” ê°ê° Microserviceë¥¼ ì›í•˜ëŠ” ê¸°ìˆ ìŠ¤íƒì„ ì‚¬ìš©í•´ì„œ ììœ ë¡­ê²Œ ê°œë°œí•˜ëŠ” ë°©ì‹ì´ë‹¤.
  - ê·¸ ì–´ë–¤ ì œì•½ë„ ì¡´ì¬í•˜ì§€ ì•Šê³  ìš°ë¦¬ê°€ ì§€ê¸ˆê¹Œì§€ ë°°ì›Œì˜¨ í†µì‹  ë°©ë²•ë“¤ë¡œ í”„ë¡œì íŠ¸ë¼ë¦¬ í†µì‹ í•œë‹¤.
- íšŒì‚¬ì— ì¸ì›ì´ ë§ì•„ì§ˆìˆ˜ë¡ Polyrepository ë°©ì‹ìœ¼ë¡œ ê°œë°œ í•  ìˆ˜ ë°–ì— ì—†ë‹¤.
  - ëŒ€ë¶€ë¶„ì˜ í° ê¸°ì—…ë“¤ì´ ì´ë ‡ê²Œ ê°œë°œí•˜ê³  ìˆë‹¤.
  - íŒ€ì´ ê°€ì¥ ì˜ ë‹¤ë£¨ë¡œ ê°ê° Microserviceì— ê°€ì¥ ì í•©í•œ ê¸°ìˆ ì„ ì‚¬ìš©í•´ì„œ ê°œë°œì„ ì§„í–‰ í•  ìˆ˜ ìˆë‹¤.
- ëª¨ë“  íŒ€ì´ ì „ë¶€ ììœ ë¡­ê²Œ ê°œë°œì„ ì§„í–‰í•˜ë‹¤ë³´ë©´ Microserviceë¥¼ ê¸°íší•˜ê¸°ìœ„í•œ ì¼ì¢…ì˜ ì•½ì†ê³¼ ì‹œìŠ¤í…œì´ í•„ìš”í•˜ë‹¤.
- ë‹¤ì–‘í•œ ë°©ë²•ì´ ì¡´ì¬í•˜ì§€ë§Œ Domain Driven Designì´ ë§¤ìš° ìœ ìš©í•˜ê²Œ ì‚¬ìš©ëœë‹¤

---

### 4.2 Domain Driven Design!?

- ë³µì¡í•œ ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ìš”êµ¬ì‚¬í•­ì„ â€œë„ë©”ì¸â€ì— ì§‘ì¤‘í•´ì„œ ì„¤ê³„í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ ê°œë°œ â€œì ‘ê·¼ë²•â€ì´ë‹¤.
- ë¹„ì¦ˆë‹ˆìŠ¤ ìš”êµ¬ì‚¬í•­ì„ ì¶©ì¡±í•˜ë©´ì„œ â€œìœ ì§€ë³´ìˆ˜â€ ê°€ëŠ¥í•˜ê²Œ ì‹œìŠ¤í…œì„ ì„¤ê³„í•˜ëŠ” ë°©ë²•ë¡ ì´ë‹¤.
- `Ubiquitous Language`ë¥¼ ë§¤ìš° ê°•ì¡°í•œë‹¤.
  - ê°œë°œìë§Œ ì´í•´ í•  ìˆ˜ ìˆëŠ” ì˜ì—­ì„ ìµœì†Œí™” í•˜ê³ ,
  - â€œë„ë©”ì¸ ì „ë¬¸ê°€â€ì™€ í•¨ê»˜ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì„¤ê³„ í•  ìˆ˜ ìˆë„ë¡ ë””ìì¸ ë˜ì—ˆë‹¤.
- í° ê·¸ë¦¼ì„ ì„¤ê³„í•˜ëŠ” `Strategic Design`ê³¼ `Tactical Design`ìœ¼ë¡œ ë‚˜ë‰œë‹¤.
- `Strategic Design`ì€ â€œì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ”ë²•â€ ë³´ë‹¤ ë„ë©”ì¸ì„ ì„¤ê³„í•˜ê³ ,
  - ê°œë°œìê°€ ì•„ë‹Œ ì‚¬ëŒë“¤ì´ ì„¤ê³„ì— ì°¸ê°€ í•  ìˆ˜ ìˆëŠ” ë£°ì„ ì •ì˜í•˜ê³  ìˆë‹¤.
- `Tactical Design`ì€ DDD ê¸°ë²•ì— ì˜í•´ ì½”ë“œë¥¼ ì‘ì„±í•˜ëŠ” ë°©ë²•ë¡ ì„ ë‹¤ë£¨ê³  ìˆë‹¤.
- `Strategic Design`ìœ¼ë¡œ í° ê·¸ë¦¼ì„ ê·¸ë¦¬ê³  `Tactical Design`ìœ¼ë¡œ ì„¸ë¶€ ì½”ë“œë¥¼ ì‘ì„±í•˜ë©´ ëœë‹¤.
- `Clean Architecture`, `Hexagonal Architecture`ì˜ â€œë„ë©”ì¸â€ì„ ì˜ ë””ìì¸ í•˜ê¸° ìœ„í•´ íƒ„ìƒí•œê²Œ ì•„ë‹ˆë‹¤.
  - êµ³ì´ ë”°ì§€ìë©´ `Domain  Driven Design`ì´ í›¨ì”¬ ë¨¼ì € ê³µê°œë˜ì—ˆë‹¤.
- `Clean Architecture`, `Hexagonal Architecture`, `Microservice Architecture`ì²˜ëŸ¼
  - â€œë„ë©”ì¸â€ì„ ì¤‘ì‹œí•˜ëŠ” ì•„ì¼€í‹±ì²˜ê°€ ì¸ê¸°ë¥¼ ëŒë©° `DDD`ê°€ ë”ìš± ê°ê´‘ì„ ë°›ê²Œ ëë‹¤.
- ë§Œë³‘í†µì¹˜ì•½ì´ ì•„ë‹ˆë‹ˆ ë§ˆìŒëŒ€ë¡œ ë¨¹ì§€ëŠ” ë§ì

---

### 4.3 Strategic Design

- ì†Œí”„íŠ¸ì›¨ì–´ ì„¤ê³„ë¥¼ ê°€ì¥ ë†’ì€ ìœ„ì¹˜ì—ì„œ í° ê·¸ë¦¼ì„ ê¸°íší•˜ëŠ”ë° ì‚¬ìš©ëœë‹¤.
- `Ubiquitous Language`ë¥¼ ì •ë¦½í•˜ëŠ” ê°€ì¥ ì¤‘ìš”í•œ ìŠ¤í…Œì´ì§€ë‹¤.
- ë„ë©”ì¸ì„ `ì½”ì–´ ë„ë©”ì¸`ê³¼ `ì„œë¸Œ ë„ë©”ì¸`ìœ¼ë¡œ ë‚˜ëˆˆë‹¤.
  - `ì½”ì–´ ë„ë©”ì¸`ì€ í•œ ë„ë©”ì¸ì˜ ê°€ì¥ ì¤‘ìš”í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë„ë©”ì¸ì´ë‹¤.
  - `ì„œë¸Œ ë„ë©”ì¸`ì€ ì½”ì–´ë„ë©”ì¸ ë§Œí¼ ì¤‘ìš”í•œ ë„ë©”ì¸ì€ ì•„ë‹ˆì§€ë§Œ í•„ìˆ˜ì ì¸ ë„ë©”ì¸ì´ë‹¤.
- ì´ì™¸ì— `ì œë„ˆë¦­ ë„ë©”ì¸` ë“± ë‹¤ë¥¸ ë¶„ë¥˜ë„ ì¡´ì¬í•œë‹¤.

![fastcam-architecture_51-8](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-8.png)

![fastcam-architecture_51-9](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-9.png)

---

### 4.4 Tactical Design

- `Tactical Design`ì€ Strategic Design ë³´ë‹¤ ë”ìš± Low Level ê´€ì ì—ì„œ ì„¤ê³„ë¥¼ ë°”ë¼ë³¸ë‹¤.
  - ì½”ë“œë¥¼ ì–´ë–»ê²Œ ì‘ì„±í•˜ë©´ íš¨ìœ¨ì ì¼ì§€ ì•Œë ¤ì¤€ë‹¤.
- `Entity â†’ Mutable`í•œ ë°ì´í„°ë‹¤.
  - ê¼­ ID í”„ë¡œí¼í‹°ë¥¼ ê°–ê³  ìˆìœ¼ë©° IDê°€ ë³€ê²½ë˜ë©´ ë‹¤ë¥¸ Entityë¡œ ê°„ì£¼ë˜ì§€ë§Œ,
  - ë‹¤ë¥¸ í”„ë¡œí¼í‹°ê°€ ë³€ê²½ëì„ ë•ŒëŠ” ê°™ì€ Entityë¡œ ì¸ì‹í•œë‹¤.
- `Value Object(VO) â†’ ID`ê°€ ì¡´ì¬í•˜ì§€ ì•Šë‹¤. ê°’ì„ ê¸°ì¤€ìœ¼ë¡œ ê°™ì€ì§€ ë‹¤ë¥¸ì§€ íŒë‹¨í•œë‹¤.
  - ì˜ˆë¥¼ë“¤ì–´ ì´ë©”ì¼ì€ ê°’ ìì²´ê°€ ì •ì²´ì„±ì„ ë¶€ê¸° ë•Œë¬¸ì— IDê°€ ë”°ë¡œ í•„ìš”ì—†ìœ¼ë©°,
  - Aê°ì²´ì˜ `test@codefactory.ai`ì™€ B ê°ì²´ì˜ `test@codefactory.ai`ëŠ” ê°™ì€ ê°’ìœ¼ë¡œ ì¸ì‹í•œë‹¤.
  - Mutableì¸ Entityì™€ ë‹¤ë¥´ê²Œ Immutableì´ë‹¤.
- Aggregate â†’ Entityì™€ Value Objectë“¤ì„ ì†Œìœ í•˜ëŠ” ê°ì²´ë‹¤. Aggregate ë‚´ë¶€ì— ìˆëŠ”
- Repositories â†’ ìš°ë¦¬ê°€ ì•Œê³ ìˆëŠ” Repositoryì™€ ë™ì¼í•˜ë‹¤. ë°ì´í„° ì˜ì†ì„ ìœ„í•´ ì‚¬ìš©ë˜ëŠ” ê°œë…ì´ë‹¤.
- Services â†’ ì—¬ëŸ¬ê°œì˜ Aggregateê°€ í•¨ê»˜ ì‘ë™í•´ì•¼í•˜ëŠ” ì½”ë“œë¥¼ ì‘ì„±í• ë•Œ ì‚¬ìš©ëœë‹¤.

---

### 4.4 Entities & Value Objects

![fastcam-architecture_51-10](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-10.png)

---

### 4.5 Aggregate & Transactional Boundary

![fastcam-architecture_51-11](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-11.png)

Transactional Boundary â†’ Transactional Boundaryì— ì†í•˜ëŠ” ê°ì²´ëŠ”
í•˜ë‚˜ì˜ Transactionìœ¼ë¡œ ë³€í™”ê°€ ì¼ì–´ë‚œë‹¤.

---

### 4.6 Repositories & Services

![fastcam-architecture_51-12](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-12.png)

---

## 5. ë„ë©”ì¸ì´ë€?

### 5.1 Microserviceë¥¼ ì–´ë–»ê²Œ ë‚˜ëˆ ì•¼í•˜ëŠ”ê°€?

- Microserviceë¥¼ ë„ëŒ€ì²´ ì–´ë–¤ ë‹¨ìœ„ë¡œ ë‚˜ëˆ„ë©´ ë˜ëŠ”ê±¸ê¹Œ?
- Microserviceì˜ ëª©ì ì€ ì„œë¹„ìŠ¤ê°„ì˜ ì˜ì¡´ì„±ì„ ì¤„ì´ê³  íš¨ìœ¨ì ìœ¼ë¡œ ë…ë¦½ì  ê°œë°œì„ ì§„í–‰í•˜ê¸° ìœ„í•¨ì´ë‹¤.
- ê·¸ëŸ¬ê¸° ìœ„í•´ì„œëŠ” ê°€ì¥ ì‘ì€ ë…¼ë¦¬ì  ë‹¨ìœ„ë¡œ ì„œë¹„ìŠ¤ë¥¼ ë¶„í•´ í•  ìˆ˜ ìˆìœ¼ë©´ ê°€ì¥ íš¨ìœ¨ì ì¸ MSAë¥¼ ìš´ì˜ í•  ìˆ˜ ìˆë‹¤.
- ì´ ê°€ì¥ ì‘ì€ ë…¼ë¦¬ì  ë‹¨ìœ„ë¥¼ ìš°ë¦¬ëŠ” í”íˆ â€œë„ë©”ì¸â€ì´ë¼ ë¶€ë¥¸ë‹¤.
- ë„ë©”ì¸ì„ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œì„ í•˜ê²Œë˜ëŠ” â€œDomain Driven Designâ€ (DDDëŠ” ì¢€ ë‚˜ì¤‘ì— ë°°ìš°ë„ë¡ í•˜ì)ì´ë‚˜,
  - Clean Architecture ë“±ì— ì˜í•˜ë©´ ë„ë©”ì¸ì€ ë¹„ì¦ˆë‹ˆìŠ¤ì˜ ì¤‘ì‹¬ ê¸°ëŠ¥ì´ ë˜ëŠ” ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§, í•´ê²°í•˜ë ¤ëŠ” ì¤‘ì‹¬ë˜ëŠ” ë¬¸ì œ ë“±ìœ¼ë¡œ í‘œí˜„ëœë‹¤.
- ë³´í†µ ì´ëŸ° ê°œë…ì€ ì˜ì–´ì˜ ì§ì—­ì´ê¸° ë•Œë¬¸ì— ì •ì˜ê°€ ë³µì¡í•˜ê²Œ ëŠê»´ì§€ì§€ë§Œ ì‚¬ì‹¤ í¬ê²Œ ì–´ë µì§€ ì•Šë‹¤.
  - ë‹¤ìŒ ìŠ¬ë¼ì´ë“œì—ì„œ ì˜ˆì œë¥¼ ë´ë³´ë„ë¡ í•´ë³´ì

---

### 5.2 ì˜¨ë¼ì¸ ì‡¼í•‘ëª° ì˜ˆì œ

![fastcam-architecture_51-13](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-13.png)

- ê° ë„ë©”ì¸ì€ ì½”ì–´ ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤.
- ê°œë°œìê°€ ì•„ë‹Œ ì¼ë°˜ ì‚¬ëŒì´ í•œ ë„ë©”ì¸ì˜ ëª…ì¹­ì„ ë´¤ì„ë•Œ ë¬´ìŠ¨ ì—­í• ì„ í•˜ëŠ”ì§€ ì•Œ ìˆ˜ ìˆê²Œ ë¶„ë¦¬ í•´ì•¼í•œë‹¤.
  - (Domain Expert:DDD)
- ì²˜ìŒë¶€í„° ì™„ë²½íˆ ë„ë©”ì¸ì„ ë‚˜ëˆŒ í•„ìš”ê°€ ì—†ë‹¤. ê°œë°œí•´ê°€ë©´ì„œ ë…ë¦½ ê°€ëŠ¥í•˜ë‹¤ê³  ìƒê°í•˜ëŠ” ë¶€ë¶„ë“¤ì„ ë¶„ë¦¬í•˜ë©´ ëœë‹¤.
  - (Shipping ë„ë©”ì¸ì— ì¼ë°˜ íƒë°°, í•­ê³µ íƒë°°ë¥¼ ê°™ì´ êµ¬í˜„í•˜ë‹¤ê°€ ì„œë¡œ ê´€ë ¨ì„±ì´ ë©€ì–´ì§€ê³ 
  - ë„ˆë¬´ ì»¤ì§€ë©´ ë‚˜ì¤‘ì— ë‚˜ëˆ ë„ ëœë‹¤.)
- ë„ë©”ì¸ì„ ë‹¤ë£°ë•ŒëŠ” ê·¸ ë„ë©”ì¸ í•˜ë‚˜ì˜ ê´€ì ì—ì„œ ì‘ì—…ì„ í•œë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, Orderì—ì„œ Customer ê³ ê°ì´ ì¡´ì¬í•˜ê³  Paymentì— Payerê°€ ì¡´ì¬í•  ìˆ˜ ìˆë‹¤.
  - ë‘˜ì€ ê°™ì€ ì‚¬ìš©ìë¥¼ ì§€ì¹­í•˜ì§€ë§Œ ì„œë¡œ ë‹¤ë¥¸ ë„ë©”ì¸ì´ê¸° ë•Œë¬¸ì— ì´ëŠ” ì¤‘ë³µì´ ì•„ë‹ˆë‹¤.

---

## 6. CQRS Pattern

### 6.1 CQRS Patternì´ë€?

![fastcam-architecture_51-14](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-14.png)

- `CQRS Pattern`ì€ `Command Query Responsibility Segregation`ì´ë‹¤.
- ì„¸ìƒì˜ APIëŠ” CRUDë¡œ ë‚˜ë‰œë‹¤ (X) â†’ ì„¸ìƒì˜ APIëŠ” â€œëª…ë ¹â€ê³¼ â€œì¡°íšŒâ€ë¡œ ë‚˜ë‰œë‹¤. (O)

---

### 6.2 CQRSâ€¦ êµ³ì´ ì™œ?

- `Command`ì™€ `Query`ê°€ ë…ë¦½ì ì´ê¸° ë•Œë¬¸ì— ë…ë¦½ì ìœ¼ë¡œ í™•ì¥ í•  ìˆ˜ ìˆë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, ì‡¼í•‘ëª° ì•±ì„ ë§Œë“ ë‹¤ë©´ ì¡°íšŒ ìš”ì²­ì´ ì••ë„ì ìœ¼ë¡œ ë§ë‹¤.
  - ì¡°íšŒ ê¸°ëŠ¥ë§Œ ë…ë¦½ì ìœ¼ë¡œ í™•ì¥í•˜ê³  ëª…ë ¹ ìš”ì²­ (ì£¼ë¬¸ë“±)ì€ í™•ì¥í•˜ì§€ ì•Šì„ ìˆ˜ ìˆë‹¤.
- ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•´ ê°ê° ìµœì í™”ëœ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤.
  - íŠ¹íˆ, ì¡°íšŒ ê¸°ëŠ¥ì€ ë°ì´í„°ë¥¼ denormalize í•œ ìƒíƒœë¡œ ì €ì¥í•´ë‘ê³ ,
  - ì¡°íšŒ ìš”ì²­ì´ ìˆì„ë•Œ ë”°ë¡œ joinë“±ì˜ ë³µì¡í•œ ì¿¼ë¦¬ ì—†ì´ ì¦‰ê°ì ì¸ ì‘ë‹µì„ í•  ìˆ˜ ìˆë‹¤.
- Commandì™€ Queryì— ë…ë¦½ì ì¸ ë³´ì•ˆì„ ì„¤ì •í•´ì„œ ê°œë°œ í•  ìˆ˜ ìˆë‹¤.
  - QueryëŠ” ìƒëŒ€ì ìœ¼ë¡œ ë³´ì•ˆì„ ì•½í•˜ê²Œ ì„¤ì •í•˜ê³  CommandëŠ” ì„¸ì„¸í•˜ê²Œ ë³´ì•ˆ ì„¤ì •ì„ í•  ìˆ˜ ìˆë‹¤.
- Microserviceë¥¼ ìš´ì˜í–ˆì„ë•Œì˜ ì¥ì ê³¼ ë‹¨ì ì´ ê±°ì˜ ìƒì†ëœë‹¤.

---

### 6.3 CQRS

![fastcam-architecture_51-15](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-15.png)

---

### 6.4 Event Driven Architecture

![fastcam-architecture_51-16](https://raw.githubusercontent.com/berenickt/image-server/refs/heads/main/nestjs/fastcam-architecture_51-16.png)
